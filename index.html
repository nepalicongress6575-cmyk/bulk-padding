<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Bulk Image Watermark Tool</title>

    <style>
      body {
        font-family: system-ui, sans-serif;
        background: #0f172a;
        color: white;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        background: #020617;
        padding: 20px;
        border-radius: 12px;
      }

      label {
        display: block;
        margin-top: 14px;
        font-size: 14px;
      }

      input,
      button {
        width: 100%;
        margin-top: 6px;
        padding: 10px;
        border-radius: 8px;
        border: none;
      }

      button {
        background: #2563eb;
        color: white;
        font-size: 16px;
        margin-top: 20px;
        cursor: pointer;
      }

      button:hover {
        background: #1d4ed8;
      }
    </style>
  </head>

  <body>
    <h1>Bulk Image Watermark Tool</h1>

    <div class="container">
      <label>
        Select Images (multiple)
        <input type="file" id="images" multiple accept="image/*" />
      </label>

      <label>
        Top Text (optional)
        <input type="text" id="text" placeholder="Your Brand Name" />
      </label>

      <label>
        Top White Bar Height (px)
        <input type="number" id="topPad" value="300" />
      </label>

      <label>
        Side Border (px)
        <input type="number" id="sidePad" value="100" />
      </label>

      <button onclick="processAll()">Process & Download ZIP</button>
    </div>

    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
      const LOGO_1_PATH = "./flag.png";
      const LOGO_2_PATH = "./tree.png";

      async function processAll() {
        const imageFiles = document.getElementById("images").files;
        const text = document.getElementById("text").value;
        const topPad = parseInt(document.getElementById("topPad").value);
        const sidePad = parseInt(document.getElementById("sidePad").value);

        if (!imageFiles.length) {
          alert("Select images first");
          return;
        }

        const zip = new JSZip();

        // Load fixed logos
        const logo1 = await loadImage(LOGO_1_PATH);
        const logo2 = await loadImage(LOGO_2_PATH);

        for (const file of imageFiles) {
          const img = await loadImage(URL.createObjectURL(file));

          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");

          canvas.width = img.width + sidePad * 2;
          canvas.height = img.height + topPad + sidePad;

          // White background
          ctx.fillStyle = "#ffffff";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Original image (no crop)
          ctx.drawImage(img, sidePad, topPad);

          // Text (top-left)
          if (text) {
            ctx.fillStyle = "#000";
            ctx.font = "bold 32px sans-serif";
            ctx.textBaseline = "middle";
            ctx.fillText(text, sidePad, topPad / 2);
          }

          // Logos (top-right, side by side)
          const logoHeight = topPad - 40;
          const gap = 20;

          const l1w = logoHeight * (logo1.width / logo1.height);
          const l2w = logoHeight * (logo2.width / logo2.height);

          const totalWidth = l1w + l2w + gap;

          let x = canvas.width - totalWidth - sidePad;
          const y = 20;

          ctx.drawImage(logo1, x, y, l1w, logoHeight);
          x += l1w + gap;
          ctx.drawImage(logo2, x, y, l2w, logoHeight);

          // Export
          const blob = await new Promise((r) => canvas.toBlob(r, "image/png"));
          zip.file(
            "watermarked-" + file.name.replace(/\.[^/.]+$/, "") + ".png",
            blob,
          );
        }

        // Download ZIP
        const zipBlob = await zip.generateAsync({ type: "blob" });
        download(zipBlob, "watermarked-images.zip");
      }

      function loadImage(src) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = reject;
          img.src = src;
        });
      }

      function download(blob, filename) {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
        URL.revokeObjectURL(link.href);
      }
    </script>
  </body>
</html>
